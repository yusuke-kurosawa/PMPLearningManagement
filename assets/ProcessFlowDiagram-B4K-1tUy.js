import{R as V,u as Z,r as i,s as f,g as _,j as t,F as ee,P as te,a as re,b as ae,G as se}from"./index-Ao3b0tZm.js";import{l as I}from"./linear-Ds3GZdaL.js";import{l as ne}from"./link-D-rkCEEk.js";import"./init-Dmth1JHB.js";const oe=V.memo(()=>{const L=Z(),w=i.useRef(null),F=i.useRef(null),[b,W]=i.useState("all"),[d,j]=i.useState(!1),[C,A]=i.useState(null),[S,M]=i.useState({width:1200,height:800}),c=i.useRef(null),v=["立上げ","計画","実行","監視・コントロール","終結"],K=[{id:"all",name:"すべて"},{id:"integration",name:"統合"},{id:"scope",name:"スコープ"},{id:"schedule",name:"スケジュール"},{id:"cost",name:"コスト"},{id:"quality",name:"品質"},{id:"resource",name:"資源"},{id:"communications",name:"コミュニケーション"},{id:"risk",name:"リスク"},{id:"procurement",name:"調達"},{id:"stakeholder",name:"ステークホルダー"}],m=i.useMemo(()=>({processes:[{id:"p1.1",name:"プロジェクト憲章の作成",group:"立上げ",area:"integration",x:0,y:0},{id:"p4.1",name:"PM計画書の作成",group:"計画",area:"integration",x:1,y:0},{id:"p4.2",name:"プロジェクト作業の指揮",group:"実行",area:"integration",x:2,y:0},{id:"p4.3",name:"プロジェクト知識の管理",group:"実行",area:"integration",x:2,y:.5},{id:"p4.4",name:"プロジェクト作業の監視",group:"監視・コントロール",area:"integration",x:3,y:0},{id:"p4.5",name:"統合変更管理",group:"監視・コントロール",area:"integration",x:3,y:.5},{id:"p4.6",name:"プロジェクトの終結",group:"終結",area:"integration",x:4,y:0},{id:"p5.1",name:"スコープ計画",group:"計画",area:"scope",x:1,y:1},{id:"p5.2",name:"要求事項収集",group:"計画",area:"scope",x:1,y:1.3},{id:"p5.3",name:"スコープ定義",group:"計画",area:"scope",x:1,y:1.6},{id:"p5.4",name:"WBS作成",group:"計画",area:"scope",x:1,y:1.9},{id:"p5.5",name:"スコープ妥当性確認",group:"監視・コントロール",area:"scope",x:3,y:1},{id:"p5.6",name:"スコープコントロール",group:"監視・コントロール",area:"scope",x:3,y:1.3},{id:"p13.1",name:"ステークホルダー特定",group:"立上げ",area:"stakeholder",x:0,y:1},{id:"p13.2",name:"SH・エンゲージメント計画",group:"計画",area:"stakeholder",x:1,y:9},{id:"p13.3",name:"SH・エンゲージメント管理",group:"実行",area:"stakeholder",x:2,y:9},{id:"p13.4",name:"SH・エンゲージメント監視",group:"監視・コントロール",area:"stakeholder",x:3,y:9}],connections:[{source:"p1.1",target:"p4.1",type:"primary"},{source:"p1.1",target:"p13.1",type:"parallel"},{source:"p4.1",target:"p5.1",type:"primary"},{source:"p5.1",target:"p5.2",type:"sequential"},{source:"p5.2",target:"p5.3",type:"sequential"},{source:"p5.3",target:"p5.4",type:"sequential"},{source:"p4.1",target:"p4.2",type:"primary"},{source:"p4.2",target:"p4.4",type:"feedback"},{source:"p4.4",target:"p4.5",type:"trigger"},{source:"p4.5",target:"p4.2",type:"update"},{source:"p13.1",target:"p13.2",type:"primary"},{source:"p13.2",target:"p13.3",type:"primary"},{source:"p13.3",target:"p13.4",type:"feedback"}]}),[]),R={integration:"#8B5CF6",scope:"#3B82F6",schedule:"#06B6D4",cost:"#10B981",quality:"#F59E0B",resource:"#EF4444",communications:"#EC4899",risk:"#DC2626",procurement:"#7C3AED",stakeholder:"#6366F1"};i.useEffect(()=>{const r=()=>{if(F.current){const{width:x,height:k}=F.current.getBoundingClientRect();M({width:x,height:k})}};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),i.useEffect(()=>{if(!w.current||!m)return;const r=f(w.current);r.selectAll("*").remove();const{width:x,height:k}=S,u={top:60,right:60,bottom:60,left:100},T=x-u.left-u.right,q=k-u.top-u.bottom,N=r.append("g").attr("transform",`translate(${u.left},${u.top})`),D=r.append("defs"),G=D.append("linearGradient").attr("id","bg-gradient").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","100%");G.append("stop").attr("offset","0%").attr("style","stop-color:#f3f4f6;stop-opacity:1"),G.append("stop").attr("offset","100%").attr("style","stop-color:#e5e7eb;stop-opacity:1"),r.append("rect").attr("width",x).attr("height",k).attr("fill","url(#bg-gradient)");const g=T/v.length;N.selectAll(".process-group-bg").data(v).enter().append("rect").attr("class","process-group-bg").attr("x",(e,a)=>a*g).attr("y",0).attr("width",g).attr("height",q).attr("fill",(e,a)=>a%2===0?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.02)").attr("stroke","#e5e7eb").attr("stroke-width",1),N.selectAll(".process-group-label").data(v).enter().append("text").attr("class","process-group-label").attr("x",(e,a)=>a*g+g/2).attr("y",-20).attr("text-anchor","middle").style("font-size","14px").style("font-weight","bold").style("fill","#374151").text(e=>e);const l=b==="all"?m.processes:m.processes.filter(e=>e.area===b),Y=m.connections.filter(e=>{const a=l.some(n=>n.id===e.source),s=l.some(n=>n.id===e.target);return a&&s}),P=I().domain([0,v.length-1]).range([g/2,T-g/2]),H=I().domain([0,10]).range([50,q-50]),J=ne().x(e=>P(e.x)).y(e=>H(e.y));D.selectAll("marker").data(["primary","sequential","feedback","parallel","trigger","update"]).enter().append("marker").attr("id",e=>`arrow-${e}`).attr("viewBox","0 -5 10 10").attr("refX",25).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("fill",e=>{switch(e){case"primary":return"#3B82F6";case"sequential":return"#10B981";case"feedback":return"#F59E0B";case"parallel":return"#8B5CF6";case"trigger":return"#EF4444";case"update":return"#EC4899";default:return"#6B7280"}});const E=N.selectAll(".process-link").data(Y).enter().append("g").attr("class","process-link");E.append("path").attr("d",e=>{const a=l.find(n=>n.id===e.source),s=l.find(n=>n.id===e.target);return J({source:{x:a.x,y:a.y},target:{x:s.x,y:s.y}})}).attr("fill","none").attr("stroke",e=>{switch(e.type){case"primary":return"#3B82F6";case"sequential":return"#10B981";case"feedback":return"#F59E0B";case"parallel":return"#8B5CF6";case"trigger":return"#EF4444";case"update":return"#EC4899";default:return"#6B7280"}}).attr("stroke-width",2).attr("stroke-dasharray",e=>e.type==="feedback"||e.type==="update"?"5,5":"0").attr("marker-end",e=>`url(#arrow-${e.type})`).attr("opacity",.7);const y=N.selectAll(".process-node").data(l).enter().append("g").attr("class","process-node").attr("transform",e=>`translate(${P(e.x)},${H(e.y)})`);y.append("rect").attr("x",-60).attr("y",-25).attr("width",120).attr("height",50).attr("rx",8).attr("fill",e=>R[e.area]).attr("fill-opacity",.9).attr("stroke",e=>R[e.area]).attr("stroke-width",2).style("filter","drop-shadow(0 2px 4px rgba(0,0,0,0.1))").style("cursor","pointer"),y.append("text").attr("text-anchor","middle").attr("dy","0.35em").style("fill","white").style("font-size","12px").style("font-weight","bold").style("pointer-events","none").text(e=>e.name).call(Q,100),y.on("mouseenter",function(){f(this).select("rect").transition().duration(200).attr("fill-opacity",1).attr("stroke-width",3)}).on("mouseleave",function(){f(this).select("rect").transition().duration(200).attr("fill-opacity",.9).attr("stroke-width",2)}).on("click",(e,a)=>{const s=_.getTermByName(a.name);s&&A(s)});function Q(e,a){e.each(function(){const s=f(this),n=s.text().split(/\s+/).reverse();let o,p=[],h=0;const U=1.1,$=s.attr("y"),z=parseFloat(s.attr("dy"));let B=s.text(null).append("tspan").attr("x",0).attr("y",$).attr("dy",z+"em");for(;o=n.pop();)p.push(o),B.text(p.join(" ")),B.node().getComputedTextLength()>a&&(p.pop(),B.text(p.join(" ")),p=[o],B=s.append("tspan").attr("x",0).attr("y",$).attr("dy",++h*U+z+"em").text(o))})}if(d){let e=0;const a=l.length,s=()=>{e<a&&d?(y.style("opacity",(n,o)=>o<=e?1:.2).filter((n,o)=>o===e).select("rect").transition().duration(300).attr("fill-opacity",1).attr("stroke-width",4).transition().duration(300).attr("fill-opacity",.9).attr("stroke-width",2),E.style("opacity",n=>{const o=l.findIndex(h=>h.id===n.source),p=l.findIndex(h=>h.id===n.target);return o<=e&&p<=e?.7:.1}),e++,c.current=setTimeout(s,800)):(j(!1),y.style("opacity",1),E.style("opacity",.7))};s()}return()=>{c.current&&clearTimeout(c.current)}},[S,m,b,d]);const O=()=>{d?(j(!1),c.current&&clearTimeout(c.current)):j(!0)},X=()=>{j(!1),c.current&&clearTimeout(c.current);const r=f(w.current);r.selectAll(".process-node").style("opacity",1),r.selectAll(".process-link").style("opacity",.7)};return t.jsxs("div",{className:"w-full h-screen flex flex-col bg-gray-50",children:[t.jsx("div",{className:"bg-white shadow-sm border-b p-4",children:t.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"プロセスフロー図"}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"PMBOKプロセスの時系列的な流れと相互関係を視覚化"})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ee,{className:"w-5 h-5 text-gray-500"}),t.jsx("select",{value:b,onChange:r=>W(r.target.value),className:"px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:K.map(r=>t.jsx("option",{value:r.id,children:r.name},r.id))})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:O,className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${d?"bg-red-500 text-white hover:bg-red-600":"bg-blue-500 text-white hover:bg-blue-600"}`,children:d?t.jsxs(t.Fragment,{children:[t.jsx(te,{className:"w-4 h-4"}),"一時停止"]}):t.jsxs(t.Fragment,{children:[t.jsx(re,{className:"w-4 h-4"}),"フロー再生"]})}),t.jsx("button",{onClick:X,className:"p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors",title:"リセット",children:t.jsx(ae,{className:"w-4 h-4"})})]})]})]})}),t.jsxs("div",{ref:F,className:"flex-1 relative",children:[t.jsx("svg",{ref:w,className:"w-full h-full"}),t.jsxs("div",{className:"absolute bottom-4 left-4 bg-white rounded-lg shadow-lg p-4",children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:"接続線の種類"}),t.jsxs("div",{className:"space-y-1 text-xs",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-8 h-0.5 bg-blue-500"}),t.jsx("span",{children:"主要フロー"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-8 h-0.5 bg-green-500"}),t.jsx("span",{children:"順次実行"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-8 h-0.5 bg-yellow-500",style:{borderStyle:"dashed",borderWidth:"1px 0"}}),t.jsx("span",{children:"フィードバック"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-8 h-0.5 bg-purple-500"}),t.jsx("span",{children:"並行実行"})]})]})]})]}),C&&t.jsx(se,{term:C,onClose:()=>A(null),onNavigateToGlossary:r=>{L("/glossary",{state:{selectedTermId:r}})}})]})});oe.displayName="ProcessFlowDiagram";export{oe as default};
