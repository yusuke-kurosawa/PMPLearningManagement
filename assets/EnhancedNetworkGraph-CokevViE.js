import{R as Q,r as l,s as R,z as W,d as Z,l as _,m as ee,e as te,f as se,h as ae,j as s,M as ne}from"./index-C1kyaogl.js";import{I as re}from"./index-BkD7Hj8s.js";import{D as oe}from"./download-vavBYt6P.js";function G(d){return d}function ce(d,...j){return le(d,G,G,j)}function le(d,j,v,S){return function b(z,y){if(y>=S.length)return v(z);const w=new re,M=S[y++];let B=-1;for(const p of z){const N=M(p,++B,z),E=w.get(N);E?E.push(p):w.set(N,[p])}for(const[p,N]of w)w.set(p,b(N,y));return j(w)}(d,0)}const ie=({data:d,onNodeClick:j})=>{const v=l.useRef(null),S=l.useRef(null),[b,z]=l.useState("force"),[y,w]=l.useState("default"),[M,B]=l.useState(1),[p,N]=l.useState(!0),[E,T]=l.useState(1),[C,ue]=l.useState(1),[L,U]=l.useState(!1),[i,q]=l.useState({width:1200,height:800}),[H,P]=l.useState(new Set),[F,A]=l.useState(null),X={force:"力学モデル",hierarchical:"階層型",circular:"円形",radial:"放射状",grid:"グリッド"},D={default:{name:"デフォルト",process:"#8B5CF6",input:"#3B82F6",tool:"#10B981",output:"#F59E0B",link:"#999",background:"#f3f4f6"},dark:{name:"ダーク",process:"#A78BFA",input:"#60A5FA",tool:"#34D399",output:"#FBBF24",link:"#666",background:"#1f2937"},colorblind:{name:"カラーブラインド対応",process:"#E69F00",input:"#56B4E9",tool:"#009E73",output:"#F0E442",link:"#999",background:"#f3f4f6"}};l.useEffect(()=>{const t=()=>{if(S.current){const{width:c,height:f}=S.current.getBoundingClientRect();q({width:c||1200,height:L?window.innerHeight-100:f||800})}};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[L]);const Y=l.useCallback((t,c)=>{const f=i.width/2,g=i.height/2,u=Math.min(i.width,i.height)*.35;switch(b){case"hierarchical":const m={};t.forEach(n=>{const e=n.type==="process"?0:n.type==="input"?-1:n.type==="output"?1:0;m[e]||(m[e]=[]),m[e].push(n)}),Object.entries(m).forEach(([n,e])=>{const r=g+parseInt(n)*150;e.forEach((a,h)=>{a.fx=(h+1)*i.width/(e.length+1),a.fy=r})});break;case"circular":t.forEach((n,e)=>{const r=e/t.length*2*Math.PI;n.fx=f+u*Math.cos(r),n.fy=g+u*Math.sin(r)});break;case"radial":const k=ce(t,n=>n.type);let $=0;k.forEach((n,e)=>{const r=2*Math.PI/k.size;n.forEach((a,h)=>{const o=e==="process"?0:u*(.5+h*.1),O=$+h/n.length*r;a.fx=f+o*Math.cos(O),a.fy=g+o*Math.sin(O)}),$+=r});break;case"grid":const x=Math.ceil(Math.sqrt(t.length));t.forEach((n,e)=>{n.fx=(e%x+1)*i.width/(x+1),n.fy=(Math.floor(e/x)+1)*i.height/(Math.ceil(t.length/x)+1)});break;default:t.forEach(n=>{n.fx=null,n.fy=null})}},[b,i]);l.useEffect(()=>{if(!d||!v.current)return;const t=R(v.current);t.selectAll("*").remove();const c=D[y];t.style("background-color",c.background);const f=t.append("g"),g=W().scaleExtent([.1,10]).on("zoom",e=>{f.attr("transform",e.transform)});t.call(g);const u=d.nodes.map(e=>({...e})),m=d.links.map(e=>({...e})),k=Z(u).force("link",_(m).id(e=>e.id).distance(100).strength(C)).force("charge",ee().strength(-300)).force("center",te(i.width/2,i.height/2)).force("collision",se().radius(e=>I(e)+5));Y(u,m);const $=f.append("g").selectAll("line").data(m).join("line").attr("stroke",c.link).attr("stroke-opacity",.6).attr("stroke-width",e=>Math.sqrt(e.value||1)),x=f.append("g").selectAll("g").data(u).join("g").call(n(k));x.each(function(e){const r=R(this),a=I(e)*E,h=K(e,c);switch(e.type){case"process":r.append("circle").attr("r",a).attr("fill",h);break;case"input":r.append("rect").attr("x",-a).attr("y",-a).attr("width",a*2).attr("height",a*2).attr("transform","rotate(45)").attr("fill",h);break;case"tool":r.append("rect").attr("x",-a).attr("y",-a).attr("width",a*2).attr("height",a*2).attr("fill",h);break;case"output":r.append("polygon").attr("points",`0,-${a} ${a},${a} -${a},${a}`).attr("fill",h);break}p&&r.append("text").text(e.name).attr("x",0).attr("y",a+15).attr("text-anchor","middle").attr("font-size","12px").attr("fill",c.background==="#1f2937"?"#fff":"#333")}),x.on("mouseenter",function(e,r){A(r),R(this).select("circle, rect, polygon").transition().duration(200).attr("opacity",.8).attr("transform","scale(1.2)")}).on("mouseleave",function(){A(null),R(this).select("circle, rect, polygon").transition().duration(200).attr("opacity",1).attr("transform","scale(1)")}).on("click",(e,r)=>{if(j&&j(r),e.shiftKey){const a=new Set(H);a.has(r.id)?a.delete(r.id):a.add(r.id),P(a)}}),k.on("tick",()=>{$.attr("x1",e=>e.source.x).attr("y1",e=>e.source.y).attr("x2",e=>e.target.x).attr("y2",e=>e.target.y),x.attr("transform",e=>`translate(${e.x},${e.y})`)}),k.alphaDecay(.02/M);function n(e){function r(o){o.active||e.alphaTarget(.3).restart(),o.subject.fx=o.subject.x,o.subject.fy=o.subject.y}function a(o){o.subject.fx=o.x,o.subject.fy=o.y}function h(o){o.active||e.alphaTarget(0),b==="force"&&(o.subject.fx=null,o.subject.fy=null)}return ae().on("start",r).on("drag",a).on("end",h)}return()=>{k.stop()}},[d,i,b,y,M,p,E,C]);const I=t=>t.type==="process"?20:15,K=(t,c)=>c[t.type]||"#999",V=()=>{const t=v.current,c=new XMLSerializer().serializeToString(t),f=new Blob([c],{type:"image/svg+xml"}),g=URL.createObjectURL(f),u=document.createElement("a");u.href=g,u.download="network-graph.svg",u.click(),URL.revokeObjectURL(g)},J=()=>{U(!L)};return s.jsxs("div",{ref:S,className:`relative ${L?"fixed inset-0 z-50 bg-white":"w-full h-full"}`,children:[s.jsxs("div",{className:"absolute top-4 right-4 bg-white rounded-lg shadow-lg p-4 space-y-4 max-w-xs",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"レイアウト"}),s.jsx("select",{value:b,onChange:t=>z(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:Object.entries(X).map(([t,c])=>s.jsx("option",{value:t,children:c},t))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"カラーテーマ"}),s.jsx("select",{value:y,onChange:t=>w(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:Object.entries(D).map(([t,c])=>s.jsx("option",{value:t,children:c.name},t))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"アニメーション速度"}),s.jsx("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:M,onChange:t=>B(parseFloat(t.target.value)),className:"w-full"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ノードサイズ"}),s.jsx("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:E,onChange:t=>T(parseFloat(t.target.value)),className:"w-full"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",id:"showLabels",checked:p,onChange:t=>N(t.target.checked),className:"rounded"}),s.jsx("label",{htmlFor:"showLabels",className:"text-sm text-gray-700",children:"ラベルを表示"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:J,className:"flex-1 px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:s.jsx(ne,{className:"w-4 h-4 mx-auto"})}),s.jsx("button",{onClick:V,className:"flex-1 px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:s.jsx(oe,{className:"w-4 h-4 mx-auto"})})]})]}),F&&s.jsxs("div",{className:"absolute bottom-4 left-4 bg-white rounded-lg shadow-lg p-4 max-w-sm",children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:F.name}),s.jsxs("p",{className:"text-sm text-gray-600",children:["タイプ: ",F.type]}),F.description&&s.jsx("p",{className:"text-sm text-gray-700 mt-2",children:F.description})]}),s.jsx("svg",{ref:v,width:i.width,height:i.height,className:"w-full h-full"})]})},pe=Q.memo(ie);export{pe as default};
