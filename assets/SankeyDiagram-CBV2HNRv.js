import{c as Z,R as dt,r as S,s as U,i as nt,j as g}from"./index-CIxq1NpN.js";import{D as ht}from"./download-CPJyUDmC.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=Z("AlignCenter",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"17",x2:"7",y1:"12",y2:"12",key:"rsh8ii"}],["line",{x1:"19",x2:"5",y1:"18",y2:"18",key:"1t0tuv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=Z("AlignJustify",[["line",{x1:"3",x2:"21",y1:"6",y2:"6",key:"4m8b97"}],["line",{x1:"3",x2:"21",y1:"12",y2:"12",key:"10d38w"}],["line",{x1:"3",x2:"21",y1:"18",y2:"18",key:"kwyyxn"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=Z("AlignLeft",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18",key:"1awlsn"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=Z("AlignRight",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}],["line",{x1:"21",x2:"7",y1:"18",y2:"18",key:"1g9eri"}]]);function ot(e,n){let o;if(n===void 0)for(const i of e)i!=null&&(o<i||o===void 0&&i>=i)&&(o=i);else{let i=-1;for(let c of e)(c=n(c,++i,e))!=null&&(o<c||o===void 0&&c>=c)&&(o=c)}return o}function ut(e,n){let o;if(n===void 0)for(const i of e)i!=null&&(o>i||o===void 0&&i>=i)&&(o=i);else{let i=-1;for(let c of e)(c=n(c,++i,e))!=null&&(o>c||o===void 0&&c>=c)&&(o=c)}return o}function Q(e,n){let o=0;if(n===void 0)for(let i of e)(i=+i)&&(o+=i);else{let i=-1;for(let c of e)(c=+n(c,++i,e))&&(o+=c)}return o}function mt(e){return e.target.depth}function kt(e){return e.depth}function bt(e,n){return n-1-e.height}function lt(e,n){return e.sourceLinks.length?e.depth:n-1}function wt(e){return e.targetLinks.length?e.depth:e.sourceLinks.length?ut(e.sourceLinks,mt)-1:0}function q(e){return function(){return e}}function rt(e,n){return J(e.source,n.source)||e.index-n.index}function st(e,n){return J(e.target,n.target)||e.index-n.index}function J(e,n){return e.y0-n.y0}function X(e){return e.value}function vt(e){return e.index}function Lt(e){return e.nodes}function jt(e){return e.links}function it(e,n){const o=e.get(n);if(!o)throw new Error("missing: "+n);return o}function at({nodes:e}){for(const n of e){let o=n.y0,i=o;for(const c of n.sourceLinks)c.y0=o+c.width/2,o+=c.width;for(const c of n.targetLinks)c.y1=i+c.width/2,i+=c.width}}function Nt(){let e=0,n=0,o=1,i=1,c=24,x=8,h,d=vt,m=lt,k,v,L=Lt,G=jt,N=6;function p(){const t={nodes:L.apply(null,arguments),links:G.apply(null,arguments)};return z(t),B(t),C(t),R(t),l(t),at(t),t}p.update=function(t){return at(t),t},p.nodeId=function(t){return arguments.length?(d=typeof t=="function"?t:q(t),p):d},p.nodeAlign=function(t){return arguments.length?(m=typeof t=="function"?t:q(t),p):m},p.nodeSort=function(t){return arguments.length?(k=t,p):k},p.nodeWidth=function(t){return arguments.length?(c=+t,p):c},p.nodePadding=function(t){return arguments.length?(x=h=+t,p):x},p.nodes=function(t){return arguments.length?(L=typeof t=="function"?t:q(t),p):L},p.links=function(t){return arguments.length?(G=typeof t=="function"?t:q(t),p):G},p.linkSort=function(t){return arguments.length?(v=t,p):v},p.size=function(t){return arguments.length?(e=n=0,o=+t[0],i=+t[1],p):[o-e,i-n]},p.extent=function(t){return arguments.length?(e=+t[0][0],o=+t[1][0],n=+t[0][1],i=+t[1][1],p):[[e,n],[o,i]]},p.iterations=function(t){return arguments.length?(N=+t,p):N};function z({nodes:t,links:s}){for(const[u,r]of t.entries())r.index=u,r.sourceLinks=[],r.targetLinks=[];const a=new Map(t.map((u,r)=>[d(u,r,t),u]));for(const[u,r]of s.entries()){r.index=u;let{source:f,target:w}=r;typeof f!="object"&&(f=r.source=it(a,f)),typeof w!="object"&&(w=r.target=it(a,w)),f.sourceLinks.push(r),w.targetLinks.push(r)}if(v!=null)for(const{sourceLinks:u,targetLinks:r}of t)u.sort(v),r.sort(v)}function B({nodes:t}){for(const s of t)s.value=s.fixedValue===void 0?Math.max(Q(s.sourceLinks,X),Q(s.targetLinks,X)):s.fixedValue}function C({nodes:t}){const s=t.length;let a=new Set(t),u=new Set,r=0;for(;a.size;){for(const f of a){f.depth=r;for(const{target:w}of f.sourceLinks)u.add(w)}if(++r>s)throw new Error("circular link");a=u,u=new Set}}function R({nodes:t}){const s=t.length;let a=new Set(t),u=new Set,r=0;for(;a.size;){for(const f of a){f.height=r;for(const{source:w}of f.targetLinks)u.add(w)}if(++r>s)throw new Error("circular link");a=u,u=new Set}}function A({nodes:t}){const s=ot(t,r=>r.depth)+1,a=(o-e-c)/(s-1),u=new Array(s);for(const r of t){const f=Math.max(0,Math.min(s-1,Math.floor(m.call(null,r,s))));r.layer=f,r.x0=e+f*a,r.x1=r.x0+c,u[f]?u[f].push(r):u[f]=[r]}if(k)for(const r of u)r.sort(k);return u}function P(t){const s=ut(t,a=>(i-n-(a.length-1)*h)/Q(a,X));for(const a of t){let u=n;for(const r of a){r.y0=u,r.y1=u+r.value*s,u=r.y1+h;for(const f of r.sourceLinks)f.width=f.value*s}u=(i-u+h)/(a.length+1);for(let r=0;r<a.length;++r){const f=a[r];f.y0+=u*(r+1),f.y1+=u*(r+1)}E(a)}}function l(t){const s=A(t);h=Math.min(x,(i-n)/(ot(s,a=>a.length)-1)),P(s);for(let a=0;a<N;++a){const u=Math.pow(.99,a),r=Math.max(1-u,(a+1)/N);_(s,u,r),y(s,u,r)}}function y(t,s,a){for(let u=1,r=t.length;u<r;++u){const f=t[u];for(const w of f){let I=0,D=0;for(const{source:O,value:K}of w.targetLinks){let V=K*(w.layer-O.layer);I+=b(O,w)*V,D+=V}if(!(D>0))continue;let F=(I/D-w.y0)*s;w.y0+=F,w.y1+=F,W(w)}k===void 0&&f.sort(J),T(f,a)}}function _(t,s,a){for(let u=t.length,r=u-2;r>=0;--r){const f=t[r];for(const w of f){let I=0,D=0;for(const{target:O,value:K}of w.sourceLinks){let V=K*(O.layer-w.layer);I+=j(w,O)*V,D+=V}if(!(D>0))continue;let F=(I/D-w.y0)*s;w.y0+=F,w.y1+=F,W(w)}k===void 0&&f.sort(J),T(f,a)}}function T(t,s){const a=t.length>>1,u=t[a];$(t,u.y0-h,a-1,s),M(t,u.y1+h,a+1,s),$(t,i,t.length-1,s),M(t,n,0,s)}function M(t,s,a,u){for(;a<t.length;++a){const r=t[a],f=(s-r.y0)*u;f>1e-6&&(r.y0+=f,r.y1+=f),s=r.y1+h}}function $(t,s,a,u){for(;a>=0;--a){const r=t[a],f=(r.y1-s)*u;f>1e-6&&(r.y0-=f,r.y1-=f),s=r.y0-h}}function W({sourceLinks:t,targetLinks:s}){if(v===void 0){for(const{source:{sourceLinks:a}}of s)a.sort(st);for(const{target:{targetLinks:a}}of t)a.sort(rt)}}function E(t){if(v===void 0)for(const{sourceLinks:s,targetLinks:a}of t)s.sort(st),a.sort(rt)}function b(t,s){let a=t.y0-(t.sourceLinks.length-1)*h/2;for(const{target:u,width:r}of t.sourceLinks){if(u===s)break;a+=r+h}for(const{source:u,width:r}of s.targetLinks){if(u===t)break;a-=r}return a}function j(t,s){let a=s.y0-(s.targetLinks.length-1)*h/2;for(const{source:u,width:r}of s.targetLinks){if(u===t)break;a+=r+h}for(const{target:u,width:r}of t.sourceLinks){if(u===s)break;a-=r}return a}return p}var Y=Math.PI,tt=2*Y,H=1e-6,_t=tt-H;function et(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function ft(){return new et}et.prototype=ft.prototype={constructor:et,moveTo:function(e,n){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+n)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,n){this._+="L"+(this._x1=+e)+","+(this._y1=+n)},quadraticCurveTo:function(e,n,o,i){this._+="Q"+ +e+","+ +n+","+(this._x1=+o)+","+(this._y1=+i)},bezierCurveTo:function(e,n,o,i,c,x){this._+="C"+ +e+","+ +n+","+ +o+","+ +i+","+(this._x1=+c)+","+(this._y1=+x)},arcTo:function(e,n,o,i,c){e=+e,n=+n,o=+o,i=+i,c=+c;var x=this._x1,h=this._y1,d=o-e,m=i-n,k=x-e,v=h-n,L=k*k+v*v;if(c<0)throw new Error("negative radius: "+c);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=n);else if(L>H)if(!(Math.abs(v*d-m*k)>H)||!c)this._+="L"+(this._x1=e)+","+(this._y1=n);else{var G=o-x,N=i-h,p=d*d+m*m,z=G*G+N*N,B=Math.sqrt(p),C=Math.sqrt(L),R=c*Math.tan((Y-Math.acos((p+L-z)/(2*B*C)))/2),A=R/C,P=R/B;Math.abs(A-1)>H&&(this._+="L"+(e+A*k)+","+(n+A*v)),this._+="A"+c+","+c+",0,0,"+ +(v*G>k*N)+","+(this._x1=e+P*d)+","+(this._y1=n+P*m)}},arc:function(e,n,o,i,c,x){e=+e,n=+n,o=+o,x=!!x;var h=o*Math.cos(i),d=o*Math.sin(i),m=e+h,k=n+d,v=1^x,L=x?i-c:c-i;if(o<0)throw new Error("negative radius: "+o);this._x1===null?this._+="M"+m+","+k:(Math.abs(this._x1-m)>H||Math.abs(this._y1-k)>H)&&(this._+="L"+m+","+k),o&&(L<0&&(L=L%tt+tt),L>_t?this._+="A"+o+","+o+",0,1,"+v+","+(e-h)+","+(n-d)+"A"+o+","+o+",0,1,"+v+","+(this._x1=m)+","+(this._y1=k):L>H&&(this._+="A"+o+","+o+",0,"+ +(L>=Y)+","+v+","+(this._x1=e+o*Math.cos(c))+","+(this._y1=n+o*Math.sin(c))))},rect:function(e,n,o,i){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+n)+"h"+ +o+"v"+ +i+"h"+-o+"Z"},toString:function(){return this._}};function ct(e){return function(){return e}}function Mt(e){return e[0]}function St(e){return e[1]}var At=Array.prototype.slice;function Et(e){return e.source}function Gt(e){return e.target}function Tt(e){var n=Et,o=Gt,i=Mt,c=St,x=null;function h(){var d,m=At.call(arguments),k=n.apply(this,m),v=o.apply(this,m);if(x||(x=d=ft()),e(x,+i.apply(this,(m[0]=k,m)),+c.apply(this,m),+i.apply(this,(m[0]=v,m)),+c.apply(this,m)),d)return x=null,d+""||null}return h.source=function(d){return arguments.length?(n=d,h):n},h.target=function(d){return arguments.length?(o=d,h):o},h.x=function(d){return arguments.length?(i=typeof d=="function"?d:ct(+d),h):i},h.y=function(d){return arguments.length?(c=typeof d=="function"?d:ct(+d),h):c},h.context=function(d){return arguments.length?(x=d??null,h):x},h}function zt(e,n,o,i,c){e.moveTo(n,o),e.bezierCurveTo(n=(n+i)/2,o,n,c,i,c)}function Bt(){return Tt(zt)}function Ct(e){return[e.source.x1,e.y0]}function Rt(e){return[e.target.x0,e.y1]}function Dt(){return Bt().source(Ct).target(Rt)}const Ht=({data:e})=>{const n=S.useRef(null),o=S.useRef(null),[i,c]=S.useState("default"),[x,h]=S.useState("justify"),[d,m]=S.useState(15),[k,v]=S.useState(10),[L,G]=S.useState({width:1200,height:800}),[N,p]=S.useState(null),[z,B]=S.useState(null),C={default:{name:"デフォルト",processGroup:{立ち上げ:"#8B5CF6",計画:"#3B82F6",実行:"#10B981","監視・コントロール":"#F59E0B",終結:"#EF4444"},link:"#e0e0e0",linkHover:"#999",text:"#333",background:"#f9fafb"},ocean:{name:"オーシャン",processGroup:{立ち上げ:"#0891b2",計画:"#0e7490",実行:"#155e75","監視・コントロール":"#164e63",終結:"#134e4a"},link:"#cbd5e1",linkHover:"#64748b",text:"#1e293b",background:"#f0f9ff"},sunset:{name:"サンセット",processGroup:{立ち上げ:"#f97316",計画:"#ea580c",実行:"#dc2626","監視・コントロール":"#b91c1c",終結:"#991b1b"},link:"#fed7aa",linkHover:"#fb923c",text:"#451a03",background:"#fff7ed"}},R={left:{name:"左寄せ",icon:yt,func:kt},right:{name:"右寄せ",icon:xt,func:bt},center:{name:"中央",icon:gt,func:wt},justify:{name:"均等",icon:pt,func:lt}};S.useEffect(()=>{const l=()=>{if(o.current){const{width:y,height:_}=o.current.getBoundingClientRect();G({width:y||1200,height:_||800})}};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]);const A=S.useMemo(()=>{if(!e)return null;const l=[],y=new Map;let _=0;["立ち上げ","計画","実行","監視・コントロール","終結"].forEach(b=>{const j={id:`pg_${b}`,name:b,type:"processGroup",index:_++};l.push(j),y.set(j.id,j)});const M=e.nodes.filter(b=>b.type==="process");[...new Set(M.map(b=>b.area))].forEach(b=>{M.filter(t=>t.area===b).forEach(t=>{const s={id:t.id,name:t.name,type:"process",area:t.area,group:t.group,index:_++};l.push(s),y.set(s.id,s)})}),["プロジェクト憲章","プロジェクトマネジメント計画書","成果物","作業パフォーマンス・データ","作業パフォーマンス報告書","変更要求","最終報告書"].forEach(b=>{const j=e.nodes.find(t=>t.type==="output"&&t.name===b);if(j){const t={id:j.id,name:j.name,type:"output",index:_++};l.push(t),y.set(t.id,t)}});const E=[];return M.forEach(b=>{const j=`pg_${b.group}`;y.has(j)&&y.has(b.id)&&E.push({source:y.get(j).index,target:y.get(b.id).index,value:1,type:"group-to-process"})}),e.links.forEach(b=>{if(b.type==="output"){const j=y.get(b.source.id||b.source),t=y.get(b.target.id||b.target);j&&t&&t.type==="output"&&E.push({source:j.index,target:t.index,value:1,type:"process-to-output",originalLink:b})}}),{nodes:l,links:E}},[e]);S.useEffect(()=>{if(!A||!n.current)return;const l=C[i],y={top:40,right:150,bottom:40,left:150},_=L.width-y.left-y.right,T=L.height-y.top-y.bottom,M=U(n.current);M.selectAll("*").remove(),M.style("background-color",l.background);const $=M.append("g").attr("transform",`translate(${y.left},${y.top})`),E=Nt().nodeId(t=>t.index).nodeAlign(R[x].func).nodeWidth(d).nodePadding(k).extent([[0,0],[_,T]])({nodes:A.nodes.map(t=>({...t})),links:A.links.map(t=>({...t}))});$.append("g").attr("fill","none").selectAll("g").data(E.links).join("g").style("mix-blend-mode","multiply").append("path").attr("d",Dt()).attr("stroke",t=>{if(t.type==="group-to-process"){const s=E.nodes[t.target];return l.processGroup[s.group]||l.link}return l.link}).attr("stroke-width",t=>Math.max(1,t.width)).attr("opacity",.5).on("mouseenter",function(t,s){B(s),U(this).attr("stroke",l.linkHover).attr("opacity",.8)}).on("mouseleave",function(t,s){B(null),U(this).attr("stroke",s.type==="group-to-process"&&l.processGroup[E.nodes[s.target].group]||l.link).attr("opacity",.5)});const j=$.append("g").selectAll("g").data(E.nodes).join("g");j.append("rect").attr("x",t=>t.x0).attr("y",t=>t.y0).attr("height",t=>t.y1-t.y0).attr("width",t=>t.x1-t.x0).attr("fill",t=>t.type==="processGroup"?l.processGroup[t.name]:t.type==="process"?nt(l.processGroup[t.group]).brighter(.5):"#94a3b8").attr("stroke",t=>nt(t.type==="processGroup"?l.processGroup[t.name]:t.type==="process"?l.processGroup[t.group]:"#64748b").darker(.5)).attr("stroke-width",1).on("mouseenter",function(t,s){p(s),U(this).attr("opacity",.8)}).on("mouseleave",function(){p(null),U(this).attr("opacity",1)}),j.append("text").attr("x",t=>t.x0<_/2?t.x1+6:t.x0-6).attr("y",t=>(t.y1+t.y0)/2).attr("dy","0.35em").attr("text-anchor",t=>t.x0<_/2?"start":"end").attr("font-size",t=>t.type==="processGroup"?"14px":"12px").attr("font-weight",t=>t.type==="processGroup"?"bold":"normal").attr("fill",l.text).text(t=>t.name).append("tspan").attr("fill","#666").attr("font-size","10px").attr("dy","1.2em").attr("x",t=>t.x0<_/2?t.x1+6:t.x0-6).text(t=>t.type==="process"?`(${t.area})`:""),M.append("text").attr("x",L.width/2).attr("y",20).attr("text-anchor","middle").attr("font-size","18px").attr("font-weight","bold").attr("fill",l.text).text("PMBOKプロセスフロー サンキーダイアグラム")},[A,L,i,x,d,k]);const P=()=>{const l=n.current,y=new XMLSerializer().serializeToString(l),_=new Blob([y],{type:"image/svg+xml"}),T=URL.createObjectURL(_),M=document.createElement("a");M.href=T,M.download="pmbok-sankey-diagram.svg",M.click(),URL.revokeObjectURL(T)};return g.jsxs("div",{ref:o,className:"relative w-full h-full bg-gray-50",children:[g.jsxs("div",{className:"absolute top-4 right-4 bg-white rounded-lg shadow-lg p-4 space-y-4 max-w-xs",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"カラーテーマ"}),g.jsx("select",{value:i,onChange:l=>c(l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:Object.entries(C).map(([l,y])=>g.jsx("option",{value:l,children:y.name},l))})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ノード配置"}),g.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(R).map(([l,y])=>{const _=y.icon;return g.jsxs("button",{onClick:()=>h(l),className:`flex items-center justify-center gap-2 px-3 py-2 rounded-md ${x===l?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[g.jsx(_,{className:"w-4 h-4"}),g.jsx("span",{className:"text-sm",children:y.name})]},l)})})]}),g.jsxs("div",{children:[g.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["ノード幅: ",d,"px"]}),g.jsx("input",{type:"range",min:"5",max:"30",value:d,onChange:l=>m(Number(l.target.value)),className:"w-full"})]}),g.jsxs("div",{children:[g.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["ノード間隔: ",k,"px"]}),g.jsx("input",{type:"range",min:"5",max:"30",value:k,onChange:l=>v(Number(l.target.value)),className:"w-full"})]}),g.jsxs("button",{onClick:P,className:"w-full px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center justify-center gap-2",children:[g.jsx(ht,{className:"w-4 h-4"}),"SVGエクスポート"]})]}),(N||z)&&g.jsxs("div",{className:"absolute bottom-4 left-4 bg-white rounded-lg shadow-lg p-4 max-w-sm",children:[N&&g.jsxs(g.Fragment,{children:[g.jsx("h3",{className:"font-semibold text-gray-900",children:N.name}),N.type==="process"&&g.jsxs(g.Fragment,{children:[g.jsxs("p",{className:"text-sm text-gray-600",children:["プロセス群: ",N.group]}),g.jsxs("p",{className:"text-sm text-gray-600",children:["知識エリア: ",N.area]})]}),g.jsxs("p",{className:"text-sm text-gray-600",children:["タイプ: ",N.type==="processGroup"?"プロセス群":N.type==="process"?"プロセス":"アウトプット"]})]}),z&&g.jsx(g.Fragment,{children:g.jsxs("p",{className:"text-sm text-gray-600",children:["接続: ",z.type==="group-to-process"?"プロセス群 → プロセス":"プロセス → アウトプット"]})})]}),g.jsx("svg",{ref:n,width:L.width,height:L.height,className:"w-full h-full"})]})},It=dt.memo(Ht);export{It as default};
