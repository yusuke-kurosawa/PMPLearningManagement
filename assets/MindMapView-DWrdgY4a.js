import{R as F,r as j,s as L,z as P,k as Z,j as m,Z as U,n as v,b as G,o as V,M as H}from"./index-CIxq1NpN.js";import{o as T}from"./ordinal-BQE2lpSl.js";import{D as W}from"./download-CPJyUDmC.js";import{a as K}from"./link-D-rkCEEk.js";import"./init-Dmth1JHB.js";import"./index-BkD7Hj8s.js";function X(e){var t=0,n=e.children,a=n&&n.length;if(!a)t=1;else for(;--a>=0;)t+=n[a].value;e.value=t}function q(){return this.eachAfter(X)}function J(e,t){let n=-1;for(const a of this)e.call(t,a,++n,this);return this}function Q(e,t){for(var n=this,a=[n],s,l,d=-1;n=a.pop();)if(e.call(t,n,++d,this),s=n.children)for(l=s.length-1;l>=0;--l)a.push(s[l]);return this}function Y(e,t){for(var n=this,a=[n],s=[],l,d,p,k=-1;n=a.pop();)if(s.push(n),l=n.children)for(d=0,p=l.length;d<p;++d)a.push(l[d]);for(;n=s.pop();)e.call(t,n,++k,this);return this}function ee(e,t){let n=-1;for(const a of this)if(e.call(t,a,++n,this))return a}function te(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,a=t.children,s=a&&a.length;--s>=0;)n+=a[s].value;t.value=n})}function ne(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function re(e){for(var t=this,n=ae(t,e),a=[t];t!==n;)t=t.parent,a.push(t);for(var s=a.length;e!==n;)a.splice(s,0,e),e=e.parent;return a}function ae(e,t){if(e===t)return e;var n=e.ancestors(),a=t.ancestors(),s=null;for(e=n.pop(),t=a.pop();e===t;)s=e,e=n.pop(),t=a.pop();return s}function ie(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function se(){return Array.from(this)}function oe(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function le(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t}function*ce(){var e=this,t,n=[e],a,s,l;do for(t=n.reverse(),n=[];e=t.pop();)if(yield e,a=e.children)for(s=0,l=a.length;s<l;++s)n.push(a[s]);while(n.length)}function O(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=de)):t===void 0&&(t=ue);for(var n=new A(e),a,s=[n],l,d,p,k;a=s.pop();)if((d=t(a.data))&&(k=(d=Array.from(d)).length))for(a.children=d,p=k-1;p>=0;--p)s.push(l=d[p]=new A(d[p])),l.parent=a,l.depth=a.depth+1;return n.eachBefore(pe)}function he(){return O(this).eachBefore(fe)}function ue(e){return e.children}function de(e){return Array.isArray(e)?e[1]:null}function fe(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function pe(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function A(e){this.data=e,this.depth=this.height=0,this.parent=null}A.prototype=O.prototype={constructor:A,count:q,each:J,eachAfter:Y,eachBefore:Q,find:ee,sum:te,sort:ne,path:re,ancestors:ie,descendants:se,leaves:oe,links:le,copy:he,[Symbol.iterator]:ce};function me(e,t){return e.parent===t.parent?1:2}function I(e){var t=e.children;return t?t[0]:e.t}function D(e){var t=e.children;return t?t[t.length-1]:e.t}function ge(e,t,n){var a=n/(t.i-e.i);t.c-=a,t.s+=n,e.c+=a,t.z+=n,t.m+=n}function xe(e){for(var t=0,n=0,a=e.children,s=a.length,l;--s>=0;)l=a[s],l.z+=t,l.m+=t,t+=l.s+(n+=l.c)}function we(e,t,n){return e.a.parent===t.parent?e.a:n}function M(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}M.prototype=Object.create(A.prototype);function ye(e){for(var t=new M(e,0),n,a=[t],s,l,d,p;n=a.pop();)if(l=n._.children)for(n.children=new Array(p=l.length),d=p-1;d>=0;--d)a.push(s=n.children[d]=new M(l[d],d)),s.parent=n;return(t.parent=new M(null,0)).children=[t],t}function be(){var e=me,t=1,n=1,a=null;function s(i){var b=ye(i);if(b.eachAfter(l),b.parent.m=-b.z,b.eachBefore(d),a)i.eachBefore(k);else{var w=i,h=i,x=i;i.eachBefore(function(c){c.x<w.x&&(w=c),c.x>h.x&&(h=c),c.depth>x.depth&&(x=c)});var u=w===h?1:e(w,h)/2,f=u-w.x,g=t/(h.x+u+f),o=n/(x.depth||1);i.eachBefore(function(c){c.x=(c.x+f)*g,c.y=c.depth*o})}return i}function l(i){var b=i.children,w=i.parent.children,h=i.i?w[i.i-1]:null;if(b){xe(i);var x=(b[0].z+b[b.length-1].z)/2;h?(i.z=h.z+e(i._,h._),i.m=i.z-x):i.z=x}else h&&(i.z=h.z+e(i._,h._));i.parent.A=p(i,h,i.parent.A||w[0])}function d(i){i._.x=i.z+i.parent.m,i.m+=i.parent.m}function p(i,b,w){if(b){for(var h=i,x=i,u=b,f=h.parent.children[0],g=h.m,o=x.m,c=u.m,$=f.m,N;u=D(u),h=I(h),u&&h;)f=I(f),x=D(x),x.a=i,N=u.z+c-h.z-g+e(u._,h._),N>0&&(ge(we(u,i,w),i,N),g+=N,o+=N),c+=u.m,g+=h.m,$+=f.m,o+=x.m;u&&!D(x)&&(x.t=u,x.m+=c-o),h&&!I(f)&&(f.t=h,f.m+=g-$,w=i)}return w}function k(i){i.x*=t,i.y=i.depth*n}return s.separation=function(i){return arguments.length?(e=i,s):e},s.size=function(i){return arguments.length?(a=!1,t=+i[0],n=+i[1],s):a?null:[t,n]},s.nodeSize=function(i){return arguments.length?(a=!0,t=+i[0],n=+i[1],s):a?[t,n]:null},s}const ze=({data:e})=>{const t=j.useRef(null),n=j.useRef(null),[a,s]=j.useState({width:1200,height:800}),[l,d]=j.useState(!1),[p,k]=j.useState(null),[i,b]=j.useState(new Set(["root"]));j.useEffect(()=>{const u=()=>{if(n.current){const{width:f,height:g}=n.current.getBoundingClientRect();s({width:f||1200,height:l?window.innerHeight:g||800})}};return u(),window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[l]);const w=j.useMemo(()=>{if(!e)return null;const u={id:"root",name:"PMBOK第6版",children:[]},f={};return e.nodes.filter(o=>o.type==="process").forEach(o=>{f[o.area]||(f[o.area]={id:`area_${o.area}`,name:`${o.area}マネジメント`,area:o.area,children:[]});let c=f[o.area].children.find(y=>y.name===o.group);c||(c={id:`${o.area}_${o.group}`,name:o.group,group:o.group,children:[]},f[o.area].children.push(c));const $={id:o.id,name:o.name,type:"process",area:o.area,group:o.group,children:[]},N={inputs:{name:"インプット",items:[]},tools:{name:"ツールと技法",items:[]},outputs:{name:"アウトプット",items:[]}};e.links.forEach(y=>{if(y.source===o.id||y.source.id===o.id){const z=e.nodes.find(B=>B.id===(y.target.id||y.target));z&&(y.type==="input"&&z.type==="input"?N.inputs.items.push(z.name):y.type==="tool"&&z.type==="tool"?N.tools.items.push(z.name):y.type==="output"&&z.type==="output"&&N.outputs.items.push(z.name))}}),Object.entries(N).forEach(([y,z])=>{if(z.items.length>0){const B={id:`${o.id}_${y}`,name:`${z.name} (${z.items.length})`,type:"category",children:z.items.slice(0,5).map((C,E)=>({id:`${o.id}_${y}_${E}`,name:C,type:y.slice(0,-1)}))};$.children.push(B)}}),c.children.push($)}),u.children=Object.values(f).sort((o,c)=>o.name.localeCompare(c.name)),u},[e]);j.useEffect(()=>{if(!w||!t.current)return;const u=a.width,f=a.height,g=L(t.current);g.selectAll("*").remove();const o=g.append("g").attr("transform",`translate(${u/2},${f/2})`),c=P().scaleExtent([.1,4]).on("zoom",r=>{o.attr("transform",`translate(${u/2},${f/2}) scale(${r.transform.k})`)});g.call(c);const $=be().size([2*Math.PI,Math.min(u,f)/2-150]).separation((r,_)=>(r.parent===_.parent?1:2)/r.depth),N=O(w);N.each(r=>{!i.has(r.data.id)&&r.children&&(r._children=r.children,r.children=null)});const y=$(N),z=y.descendants(),B=y.links(),C=T().domain(["統合","スコープ","スケジュール","コスト","品質","資源","コミュニケーション","リスク","調達","ステークホルダー"]).range(["#8B5CF6","#3B82F6","#06B6D4","#10B981","#F59E0B","#EF4444","#EC4899","#6366F1","#84CC16","#F97316"]),E={立ち上げ:"#9333ea",計画:"#2563eb",実行:"#059669","監視・コントロール":"#d97706",終結:"#dc2626"};o.selectAll(".link").data(B).enter().append("path").attr("class","link").attr("d",K().angle(r=>r.x).radius(r=>r.y)).attr("fill","none").attr("stroke","#ccc").attr("stroke-width",2);const S=o.selectAll(".node").data(z).enter().append("g").attr("class","node").attr("transform",r=>`
        rotate(${r.x*180/Math.PI-90})
        translate(${r.y},0)
      `);S.append("circle").attr("r",r=>r.depth===0?30:r.depth===1?20:r.depth===2?15:r.depth===3?10:5).attr("fill",r=>r.depth===0?"#6366f1":r.depth===1?C(r.data.area):r.depth===2?E[r.data.group]||"#94a3b8":r.depth===3?"#e5e7eb":"#f3f4f6").attr("stroke",r=>r.children||r._children?"#333":"none").attr("stroke-width",2).attr("cursor","pointer").on("click",(r,_)=>{if(r.stopPropagation(),_.children||_._children){const R=new Set(i);_.children?(_._children=_.children,_.children=null,R.delete(_.data.id)):(_.children=_._children,_._children=null,R.add(_.data.id)),b(R)}k(_.data)}),S.append("text").attr("dy",".31em").attr("x",r=>r.x<Math.PI==!r.children?6:-6).attr("text-anchor",r=>r.x<Math.PI==!r.children?"start":"end").attr("transform",r=>r.x>=Math.PI?"rotate(180)":null).attr("font-size",r=>r.depth===0?"16px":r.depth===1?"14px":r.depth===2?"12px":"10px").attr("font-weight",r=>r.depth<=1?"bold":"normal").text(r=>r.data.name.length>20?r.data.name.substring(0,20)+"...":r.data.name).style("cursor","pointer"),S.filter(r=>r.children||r._children).append("text").attr("x",r=>r.x<Math.PI==!r.children?-15:15).attr("dy",".31em").attr("text-anchor","middle").attr("font-size","12px").attr("font-weight","bold").text(r=>r.children?"−":"+").style("cursor","pointer"),window.zoomIn=()=>{g.transition().call(c.scaleBy,1.3)},window.zoomOut=()=>{g.transition().call(c.scaleBy,.7)},window.resetZoom=()=>{g.transition().call(c.transform,Z)}},[w,a,i]);const h=()=>{const u=t.current,f=new XMLSerializer().serializeToString(u),g=new Blob([f],{type:"image/svg+xml"}),o=URL.createObjectURL(g),c=document.createElement("a");c.href=o,c.download="pmbok-mindmap.svg",c.click(),URL.revokeObjectURL(o)},x=()=>{d(!l)};return m.jsxs("div",{ref:n,className:`relative ${l?"fixed inset-0 z-50 bg-white":"w-full h-full"}`,children:[m.jsxs("div",{className:"absolute top-4 right-4 bg-white rounded-lg shadow-lg p-4 space-y-2",children:[m.jsxs("div",{className:"flex gap-2",children:[m.jsx("button",{onClick:()=>window.zoomIn&&window.zoomIn(),className:"p-2 bg-gray-100 hover:bg-gray-200 rounded-md",title:"拡大",children:m.jsx(U,{className:"w-4 h-4"})}),m.jsx("button",{onClick:()=>window.zoomOut&&window.zoomOut(),className:"p-2 bg-gray-100 hover:bg-gray-200 rounded-md",title:"縮小",children:m.jsx(v,{className:"w-4 h-4"})}),m.jsx("button",{onClick:()=>window.resetZoom&&window.resetZoom(),className:"p-2 bg-gray-100 hover:bg-gray-200 rounded-md",title:"リセット",children:m.jsx(G,{className:"w-4 h-4"})}),m.jsx("button",{onClick:x,className:"p-2 bg-blue-600 text-white hover:bg-blue-700 rounded-md",title:l?"通常表示":"フルスクリーン",children:l?m.jsx(V,{className:"w-4 h-4"}):m.jsx(H,{className:"w-4 h-4"})}),m.jsx("button",{onClick:h,className:"p-2 bg-green-600 text-white hover:bg-green-700 rounded-md",title:"エクスポート",children:m.jsx(W,{className:"w-4 h-4"})})]}),m.jsxs("p",{className:"text-xs text-gray-600 mt-2",children:["• ノードをクリックして展開/折りたたみ",m.jsx("br",{}),"• ドラッグでパン、スクロールでズーム"]})]}),p&&m.jsxs("div",{className:"absolute bottom-4 left-4 bg-white rounded-lg shadow-lg p-4 max-w-sm",children:[m.jsx("h3",{className:"font-semibold text-gray-900",children:p.name}),p.area&&m.jsxs("p",{className:"text-sm text-gray-600",children:["知識エリア: ",p.area]}),p.group&&m.jsxs("p",{className:"text-sm text-gray-600",children:["プロセス群: ",p.group]}),p.type&&m.jsxs("p",{className:"text-sm text-gray-600",children:["タイプ: ",p.type]})]}),m.jsx("svg",{ref:t,width:a.width,height:a.height,className:"w-full h-full",style:{background:"#f9fafb"}})]})},Ae=F.memo(ze);export{Ae as default};
