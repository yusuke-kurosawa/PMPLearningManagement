import{R as G,r as v,s as $,j as d}from"./index-ER2BAsXA.js";import{i as H}from"./init-Dmth1JHB.js";import{o as P}from"./ordinal-BQE2lpSl.js";import{s as W,Y as B,a as F}from"./YlOrRd-B4FBjN7L.js";import{l as D,f as I}from"./linear-CZvfbkct.js";import{D as U}from"./download-B7rvK32z.js";import"./index-BkD7Hj8s.js";function T(e,h,f){e=+e,h=+h,f=(a=arguments.length)<2?(h=e,e=0,1):a<3?1:+f;for(var l=-1,a=Math.max(0,Math.ceil((h-e)/f))|0,p=new Array(a);++l<a;)p[l]=e+l*f;return p}function z(){var e=P().unknown(void 0),h=e.domain,f=e.range,l=0,a=1,p,m,b=!1,u=0,y=0,j=.5;delete e.unknown;function x(){var r=h().length,g=a<l,k=g?a:l,t=g?l:a;p=(t-k)/Math.max(1,r-u+y*2),b&&(p=Math.floor(p)),k+=(t-k-p*(r-u))*j,m=p*(1-u),b&&(k=Math.round(k),m=Math.round(m));var o=T(r).map(function(s){return k+p*s});return f(g?o.reverse():o)}return e.domain=function(r){return arguments.length?(h(r),x()):h()},e.range=function(r){return arguments.length?([l,a]=r,l=+l,a=+a,x()):[l,a]},e.rangeRound=function(r){return[l,a]=r,l=+l,a=+a,b=!0,x()},e.bandwidth=function(){return m},e.step=function(){return p},e.round=function(r){return arguments.length?(b=!!r,x()):b},e.padding=function(r){return arguments.length?(u=Math.min(1,y=+r),x()):u},e.paddingInner=function(r){return arguments.length?(u=Math.min(1,r),x()):u},e.paddingOuter=function(r){return arguments.length?(y=+r,x()):y},e.align=function(r){return arguments.length?(j=Math.max(0,Math.min(1,r)),x()):j},e.copy=function(){return z(h(),[l,a]).round(b).paddingInner(u).paddingOuter(y).align(j)},H.apply(x(),arguments)}const Y=({data:e,progressData:h})=>{const f=v.useRef(null),l=v.useRef(null),[a,p]=v.useState({width:1200,height:800}),[m,b]=v.useState("complexity"),[u,y]=v.useState(null),[j,x]=v.useState(!0),r={complexity:{name:"複雑度",description:"ITTOの数に基づくプロセスの複雑さ",calculate:t=>e?e.links.filter(s=>s.source===t.id||s.source.id===t.id||s.target===t.id||s.target.id===t.id).length:0},progress:{name:"学習進捗",description:"各プロセスの学習完了度",calculate:t=>{if(!h)return 0;const o=h[t.id];return o?o.understandingLevel:0}},connectivity:{name:"接続性",description:"他のプロセスとの関連度",calculate:t=>{if(!e)return 0;const o=new Set;return e.links.forEach(s=>{if(s.source===t.id||s.source.id===t.id){const i=e.nodes.find(c=>c.id===(s.target.id||s.target));i&&i.type==="process"&&o.add(i.id)}if(s.target===t.id||s.target.id===t.id){const i=e.nodes.find(c=>c.id===(s.source.id||s.source));i&&i.type==="process"&&o.add(i.id)}}),o.size}},importance:{name:"重要度",description:"PMP試験での出題頻度（推定）",calculate:t=>({プロジェクト憲章の作成:10,プロジェクトマネジメント計画書の作成:10,"プロジェクト作業の指揮・マネジメント":9,"プロジェクト作業の監視・コントロール":9,統合変更管理:10,スコープの定義:8,WBSの作成:9,スケジュールの作成:9,コストの見積り:8,リスクの特定:9,"リスク分析（定性的）":8,ステークホルダーの特定:9,コミュニケーションの管理:8})[t.name]||5}};v.useEffect(()=>{const t=()=>{if(l.current){const{width:o,height:s}=l.current.getBoundingClientRect();p({width:o||1200,height:s||800})}};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const g=v.useMemo(()=>{if(!e)return null;const t=e.nodes.filter(c=>c.type==="process"),o=["統合","スコープ","スケジュール","コスト","品質","資源","コミュニケーション","リスク","調達","ステークホルダー"],s=["立ち上げ","計画","実行","監視・コントロール","終結"],i=[];return o.forEach((c,M)=>{s.forEach((w,S)=>{const N=t.find(n=>n.area===c&&n.group===w);if(N){const n=r[m].calculate(N);i.push({area:c,group:w,areaIndex:M,groupIndex:S,process:N,value:n})}})}),{matrix:i,knowledgeAreas:o,processGroups:s,maxValue:Math.max(...i.map(c=>c.value))}},[e,h,m]);v.useEffect(()=>{if(!g||!f.current)return;const t={top:120,right:200,bottom:60,left:200},o=a.width-t.left-t.right,s=a.height-t.top-t.bottom,i=$(f.current);i.selectAll("*").remove();const c=i.append("g").attr("transform",`translate(${t.left},${t.top})`),M=z().domain(g.processGroups).range([0,o]).padding(.1),w=z().domain(g.knowledgeAreas).range([0,s]).padding(.1),S=W().domain([0,g.maxValue]).interpolator(B),N=c.selectAll(".cell").data(g.matrix).enter().append("g").attr("class","cell");if(N.append("rect").attr("x",n=>M(n.group)).attr("y",n=>w(n.area)).attr("width",M.bandwidth()).attr("height",w.bandwidth()).attr("fill",n=>S(n.value)).attr("stroke","#fff").attr("stroke-width",2).attr("rx",4).attr("ry",4).style("cursor","pointer").on("mouseenter",(n,A)=>{y(A),$(n.target).attr("stroke","#333").attr("stroke-width",3)}).on("mouseleave",n=>{y(null),$(n.target).attr("stroke","#fff").attr("stroke-width",2)}),N.append("text").attr("x",n=>M(n.group)+M.bandwidth()/2).attr("y",n=>w(n.area)+w.bandwidth()/2).attr("text-anchor","middle").attr("dy",".35em").attr("font-size","14px").attr("font-weight","bold").attr("fill",n=>n.value>g.maxValue*.6?"#fff":"#333").text(n=>n.value.toFixed(0)).style("pointer-events","none"),c.append("g").attr("transform","translate(0,-10)").selectAll("text").data(g.processGroups).enter().append("text").attr("x",n=>M(n)+M.bandwidth()/2).attr("y",0).attr("text-anchor","middle").attr("font-size","14px").attr("font-weight","bold").text(n=>n),c.append("g").attr("transform","translate(-10,0)").selectAll("text").data(g.knowledgeAreas).enter().append("text").attr("x",0).attr("y",n=>w(n)+w.bandwidth()/2).attr("text-anchor","end").attr("dy",".35em").attr("font-size","14px").attr("font-weight","bold").text(n=>`${n}マネジメント`),i.append("text").attr("x",a.width/2).attr("y",40).attr("text-anchor","middle").attr("font-size","20px").attr("font-weight","bold").text(`PMBOKプロセス ${r[m].name}ヒートマップ`),j){const O=D().domain([0,g.maxValue]).range([0,300]),V=F(O).ticks(5).tickFormat(I(".0f")),L=i.append("g").attr("transform",`translate(${a.width-t.right-300-50},${t.top-60})`),C=i.append("defs").append("linearGradient").attr("id","legend-gradient").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%"),E=10;for(let R=0;R<=E;R++)C.append("stop").attr("offset",`${R/E*100}%`).attr("stop-color",S(R/E*g.maxValue));L.append("rect").attr("width",300).attr("height",20).attr("fill","url(#legend-gradient)").attr("stroke","#ccc"),L.append("g").attr("transform","translate(0,20)").call(V),L.append("text").attr("x",300/2).attr("y",-10).attr("text-anchor","middle").attr("font-size","12px").text(r[m].name)}},[g,a,m,j]);const k=()=>{const t=f.current,o=new XMLSerializer().serializeToString(t),s=new Blob([o],{type:"image/svg+xml"}),i=URL.createObjectURL(s),c=document.createElement("a");c.href=i,c.download="pmbok-heatmap.svg",c.click(),URL.revokeObjectURL(i)};return d.jsxs("div",{ref:l,className:"relative w-full h-full bg-gray-50",children:[d.jsxs("div",{className:"absolute top-4 right-4 bg-white rounded-lg shadow-lg p-4 space-y-4 max-w-xs",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"表示メトリクス"}),d.jsx("select",{value:m,onChange:t=>b(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:Object.entries(r).map(([t,o])=>d.jsx("option",{value:t,children:o.name},t))}),d.jsx("p",{className:"text-xs text-gray-600 mt-1",children:r[m].description})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("input",{type:"checkbox",id:"showLegend",checked:j,onChange:t=>x(t.target.checked),className:"rounded"}),d.jsx("label",{htmlFor:"showLegend",className:"text-sm text-gray-700",children:"凡例を表示"})]}),d.jsxs("button",{onClick:k,className:"w-full px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center justify-center gap-2",children:[d.jsx(U,{className:"w-4 h-4"}),"SVGエクスポート"]})]}),u&&d.jsxs("div",{className:"absolute bottom-4 left-4 bg-white rounded-lg shadow-lg p-4 max-w-sm",children:[d.jsx("h3",{className:"font-semibold text-gray-900",children:u.process.name}),d.jsxs("p",{className:"text-sm text-gray-600",children:["知識エリア: ",u.area,"マネジメント"]}),d.jsxs("p",{className:"text-sm text-gray-600",children:["プロセス群: ",u.group]}),d.jsxs("div",{className:"mt-2 pt-2 border-t",children:[d.jsxs("p",{className:"text-sm font-semibold",children:[r[m].name,": ",u.value.toFixed(1)]}),m==="progress"&&d.jsxs("p",{className:"text-sm text-gray-600",children:["理解度: ",(u.value*10).toFixed(0),"%"]})]})]}),d.jsx("svg",{ref:f,width:a.width,height:a.height,className:"w-full h-full"})]})},tt=G.memo(Y);export{tt as default};
